<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Organization Tree</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    svg { border: 1px solid #eee; display: block; margin: 20px auto; }
    text { font-size: 12px; }
  </style>
</head>
<body>
  <h2 style="text-align:center">Organization Chart (D3 Tree)</h2>
  <svg width="800" height="500"></svg>

  <script>
    // Fetch the hierarchical data from the same server
    fetch('/api/org')
      .then(res => res.json())
      .then(rootData => {
        const svg = d3.select('svg');
        const width = +svg.attr('width');
        const height = +svg.attr('height');

        // Create a D3 hierarchy and tree layout
        const root = d3.hierarchy(rootData);
        const tree = d3.tree().size([width - 160, height - 120]); // [x, y]
        tree(root);

        // Draw links (lines)
        svg.append('g')
          .selectAll('line')
          .data(root.links())
          .enter()
          .append('line')
          .attr('x1', d => d.source.x + 80)
          .attr('y1', d => d.source.y + 40)
          .attr('x2', d => d.target.x + 80)
          .attr('y2', d => d.target.y + 40)
          .attr('stroke', '#999');

        // Draw nodes (circles)
        const nodes = svg.append('g')
          .selectAll('g')
          .data(root.descendants())
          .enter()
          .append('g')
          .attr('transform', d => `translate(${d.x + 80},${d.y + 40})`);

        nodes.append('circle').attr('r', 6).attr('fill', 'steelblue');

        // Labels
        nodes.append('text')
          .attr('x', 10)
          .attr('y', 4)
          .text(d => d.data.name);
      })
      .catch(err => {
        console.error('Failed to load org data', err);
        d3.select('body').append('p').text('Error loading data: ' + err.message);
      });
  </script>
</body>
</html>
